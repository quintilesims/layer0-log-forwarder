# Layer0 Log Forwarder

This terraform module forwards logs generated by services and tasks deployed via Layer0 to a Kinesis stream.

## Overview

Each layer0 instance create a Cloudwatch Logs Group named `l0-<layer0_instance_prefix>`.

This module will create infrastructure to forward all logs from a log group to a Kinesis Stream. Extra Layer0 metadata will be added to each log event, to map a given event to an Layer0 instance, environment and service.

For Example:

##### Cloudwatch log event
```
[Warning] Running out of disk space
```

##### What gets written to the Kinesis stream
```json
{
    "Severity": "Warning",
    "Message": "[WARNING] Running out of disk space",
    "LogGroupName": "l0-prod105",
    "LogStreamName": "l0/guestbook/d473bcee-a64d-49b5-95c4-c135af3f8eb0",
    "TaskGuid": "d473bcee-a64d-49b5-95c4-c135af3f8eb0",
    "Layer0": {
        "ContainerName": "guestbook",
        "ServiceId": "guestbo317bf",
        "EnvironmentId": "demod2ef4cd1",
        "Instance": "prod105"
    }
}
```

## Resources created

The module creates the following resources:

* Lambda (Node.js 6.10)
* Cloudwatch logs filter subscription
* IAM role
* IAM policy
* IAM policy attachment